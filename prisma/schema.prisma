generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model positions {
  id           String    @id
  userId       String
  positionId   String    @unique
  poolAddress  String
  zbtcAmount   Decimal   @db.Decimal(20, 8)
  entryPrice   Decimal   @db.Decimal(20, 8)
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  lastChecked  DateTime  @default(now())
  entryBin     Int       @default(0)
  solAmount    Decimal   @default(0) @db.Decimal(20, 8)
  zbtcReturned Decimal?  @db.Decimal(20, 8)
  solReturned  Decimal?  @db.Decimal(20, 8)
  exitPrice    Decimal?  @db.Decimal(20, 8)
  exitBin      Int?
  zbtcFees     Decimal?  @default(0) @db.Decimal(20, 8)
  solFees      Decimal?  @default(0) @db.Decimal(20, 8)
  pnlUsd       Decimal?  @db.Decimal(20, 8)
  pnlPercent   Decimal?  @db.Decimal(10, 4)
  closedAt     DateTime? @db.Timestamp(6)
  users        users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([positionId])
  @@index([userId, isActive])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_stats {
  id              String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId          String    @unique
  totalPositions  Int?      @default(0)
  activePositions Int?      @default(0)
  totalZbtcFees   Decimal?  @default(0) @db.Decimal(20, 8)
  totalSolFees    Decimal?  @default(0) @db.Decimal(20, 8)
  totalPnlUsd     Decimal?  @default(0) @db.Decimal(20, 8)
  avgPositionSize Decimal?  @default(0) @db.Decimal(20, 8)
  avgHoldTime     Int?      @default(0)
  updatedAt       DateTime? @default(now()) @db.Timestamp(6)
  users           users     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id           String      @id
  telegramId   BigInt      @unique
  username     String?
  isMonitoring Boolean     @default(false)
  createdAt    DateTime    @default(now())
  positions    positions[]
  user_stats   user_stats?
  wallets      wallets?

  @@index([telegramId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wallets {
  id        String   @id
  userId    String   @unique
  publicKey String   @unique
  encrypted String
  iv        String
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([publicKey])
}
